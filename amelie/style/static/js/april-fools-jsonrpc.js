(function($,undefined){$.extend({jsonRPC:{version:"2.0",endPoint:null,namespace:null,setup:function(e){this._validateConfigParams(e);this.endPoint=e.endPoint;this.namespace=e.namespace;this.cache=e.cache!==undefined?cache:true;return this},withOptions:function(e,t){this._validateConfigParams(e);if(t===undefined)throw"No callback specified";origParams={endPoint:this.endPoint,namespace:this.namespace};this.setup(e);t.call(this);this.setup(origParams)},request:function(e,t){if(t===undefined){t={id:1}}if(t.id===undefined){t.id=1}if(t.cache===undefined){t.cache=this.cache}this._validateRequestMethod(e);this._validateRequestParams(t.params);this._validateRequestCallbacks(t.success,t.error);this._doRequest(JSON.stringify(this._requestDataObj(e,t.params,t.id)),t);return true},batchRequest:function(e,t){if(t===undefined){t={}}if(!$.isArray(e)||e.length===0)throw"Invalid requests supplied for jsonRPC batchRequest. Must be an array object that contain at least a method attribute";var n=this;$.each(e,function(e,t){n._validateRequestMethod(t.method);n._validateRequestParams(t.params);if(t.id===undefined){t.id=e+1}});this._validateRequestCallbacks(t.success,t.error);var r=[],i;for(var s=0;s<e.length;s++){i=e[s];r.push(this._requestDataObj(i.method,i.params,i.id))}this._doRequest(JSON.stringify(r),t)},_validateConfigParams:function(e){if(e===undefined){throw"No params specified"}else{if(e.endPoint&&typeof e.endPoint!=="string"){throw"endPoint must be a string"}if(e.namespace&&typeof e.namespace!=="string"){throw"namespace must be a string"}}},_validateRequestMethod:function(e){if(typeof e!=="string")throw"Invalid method supplied for jsonRPC request";return true},_validateRequestParams:function(e){if(!(e===null||e===undefined||typeof e==="object"||$.isArray(e))){throw"Invalid params supplied for jsonRPC request. It must be empty, an object or an array."}return true},_validateRequestCallbacks:function(e,t){if(e!==undefined&&typeof e!=="function")throw"Invalid success callback supplied for jsonRPC request";if(t!==undefined&&typeof t!=="function")throw"Invalid error callback supplied for jsonRPC request";return true},_doRequest:function(e,t){var n=this;$.ajax({type:"POST",async:false!==t.async,dataType:"json",contentType:"application/json",url:this._requestUrl(t.endPoint||t.url,t.cache),data:e,cache:t.cache,processData:false,error:function(e){n._requestError.call(n,e,t.error)},success:function(e){n._requestSuccess.call(n,e,t.success,t.error)}})},_requestUrl:function(e,t){e=e||this.endPoint;if(!t){if(e.indexOf("?")<0){e+="?tm="+(new Date).getTime()}else{e+="&tm="+(new Date).getTime()}}return e},_requestDataObj:function(e,t,n){var r={jsonrpc:this.version,method:this.namespace?this.namespace+"."+e:e,id:n};if(t!==undefined){r.params=t}return r},_requestError:function(json,error){if(error!==undefined&&typeof error==="function"){if(typeof json.responseText==="string"){try{error(eval("("+json.responseText+")"))}catch(e){error(this._response())}}else{error(this._response())}}},_requestSuccess:function(e,t,n){var r=this._response(e);if(r.error&&typeof n==="function"){n(r);return}if(typeof t==="function"){t(r)}},_response:function(json){if(json===undefined){return{error:"Internal server error",version:"2.0"}}else{try{if(typeof json==="string"){json=eval("("+json+")")}if($.isArray(json)&&json.length>0&&json[0].jsonrpc!=="2.0"||!$.isArray(json)&&json.jsonrpc!=="2.0"){throw"Version error"}return json}catch(e){return{error:"Internal server error: "+e,version:"2.0"}}}}}})})(jQuery)